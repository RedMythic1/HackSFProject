(()=>{"use strict";var t=function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function s(t){try{o(r.next(t))}catch(t){a(t)}}function c(t){try{o(r.throw(t))}catch(t){a(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}o((r=r.apply(t,e||[])).next())}))},e=function(t,e){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=c(0),s.throw=c(1),s.return=c(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(c){return function(o){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,o])}}},n=function(){function n(){this.baseUrl="",this.baseUrl="localhost"===window.location.hostname?"http://localhost:3000":"",console.log("ApiService initialized with baseUrl: ".concat(this.baseUrl))}return n.prototype.getArticles=function(n){return t(this,void 0,void 0,(function(){var t,r,i,a,s;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),t=n?"?interests=".concat(encodeURIComponent(n)):"",r="".concat(this.baseUrl,"/api/articles").concat(t),console.log("Fetching articles from: ".concat(r)),[4,fetch(r)];case 1:if(!(i=e.sent()).ok)throw console.error("Error response from server: ".concat(i.status)),new Error("Failed to fetch articles: ".concat(i.statusText));return[4,i.json()];case 2:return a=e.sent(),console.log("Articles fetched successfully. Count: ".concat(a.length)),[2,a];case 3:return s=e.sent(),console.error("Error fetching articles:",s),[2,[]];case 4:return[2]}}))}))},n.prototype.getArticleDetails=function(n){return t(this,void 0,void 0,(function(){var t,r,i,a;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),t="".concat(this.baseUrl,"/api/article/").concat(n),console.log("Fetching article details from: ".concat(t)),[4,fetch(t)];case 1:if(!(r=e.sent()).ok)throw console.error("Error response from server: ".concat(r.status)),new Error("Failed to fetch article details: ".concat(r.statusText));return[4,r.json()];case 2:return i=e.sent(),console.log("Article details fetched successfully"),[2,i];case 3:return a=e.sent(),console.error("Error fetching article details:",a),[2,null];case 4:return[2]}}))}))},n.prototype.analyzeInterests=function(n){return t(this,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,fetch("".concat(this.baseUrl,"/api/analyze-interests"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({interests:n})})];case 1:if(!(t=e.sent()).ok)throw new Error("Failed to analyze interests");return[4,t.json()];case 2:return[2,e.sent()];case 3:return r=e.sent(),console.error("Error analyzing interests:",r),[2,null];case 4:return[2]}}))}))},n}(),r=function(){function r(){this.apiService=new n,this.articlesContainer=document.getElementById("articles-container"),this.interestsInput=document.getElementById("interests-input"),this.submitButton=document.getElementById("submit-interests"),this.initEventListeners(),this.loadArticles()}return r.prototype.initEventListeners=function(){var t=this;this.submitButton&&this.submitButton.addEventListener("click",(function(){return t.handleInterestsSubmit()}))},r.prototype.loadArticles=function(n){return t(this,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:if(!this.articlesContainer)return[2];this.articlesContainer.innerHTML='<div class="loading">Loading articles...</div>',e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.apiService.getArticles(n)];case 2:return 0===(t=e.sent()).length?(this.articlesContainer.innerHTML='<div class="error">No articles found</div>',[2]):(this.renderArticles(t),[3,4]);case 3:return r=e.sent(),console.error("Error loading articles:",r),this.articlesContainer.innerHTML='<div class="error">Error loading articles. Please try again later.</div>',[3,4];case 4:return[2]}}))}))},r.prototype.renderArticles=function(t){var e=this;this.articlesContainer&&(this.articlesContainer.innerHTML="",t.forEach((function(t){var n,r=t.link.split("id=")[1]||"",i=document.createElement("div");i.className="article-card",i.innerHTML='\n                <div class="article-header">\n                    <h3 class="article-title">'.concat(e.escapeHtml(t.title),'</h3>\n                    <span class="article-score">Score: ').concat(t.score,'</span>\n                </div>\n                <div class="article-body">\n                    <div class="article-subject">').concat(e.escapeHtml(t.subject),'</div>\n                    <a href="/article/').concat(r,'" class="article-link" data-article-id="').concat(r,'">Read more</a>\n                </div>\n            ');var a=i.querySelector(".article-link");a&&a.addEventListener("click",(function(t){t.preventDefault(),e.viewArticleDetails(r)})),null===(n=e.articlesContainer)||void 0===n||n.appendChild(i)})))},r.prototype.viewArticleDetails=function(n){return t(this,void 0,void 0,(function(){var t,r,i,a=this;return e(this,(function(e){switch(e.label){case 0:if(!this.articlesContainer)return[2];this.articlesContainer.innerHTML='<div class="loading">Loading article details...</div>',e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.apiService.getArticleDetails(n)];case 2:return(t=e.sent())?(this.renderArticleDetail(t),[3,4]):(this.articlesContainer.innerHTML='<div class="error">Article not found</div>',(i=document.createElement("button")).textContent="Back to Articles",i.className="back-button",i.addEventListener("click",(function(){var t,e=(null===(t=a.interestsInput)||void 0===t?void 0:t.value)||"";a.loadArticles(e)})),this.articlesContainer.appendChild(i),[2]);case 3:return r=e.sent(),console.error("Error loading article details:",r),this.articlesContainer.innerHTML='<div class="error">Error loading article details. Please try again later.</div>',(i=document.createElement("button")).textContent="Back to Articles",i.className="back-button",i.addEventListener("click",(function(){var t,e=(null===(t=a.interestsInput)||void 0===t?void 0:t.value)||"";a.loadArticles(e)})),this.articlesContainer.appendChild(i),[3,4];case 4:return[2]}}))}))},r.prototype.renderArticleDetail=function(t){var e=this;if(this.articlesContainer){this.articlesContainer.innerHTML="";var n=document.createElement("div");n.className="article-detail",n.innerHTML="\n            <h2>".concat(this.escapeHtml(t.title),'</h2>\n            <div class="article-summary">\n                ').concat(this.formatSummary(t.summary),'\n            </div>\n            <div class="article-actions">\n                <a href="').concat(t.link,'" target="_blank" class="article-link">View Original</a>\n                <button id="back-to-articles" class="back-button">Back to Articles</button>\n            </div>\n        ');var r=n.querySelector("#back-to-articles");r&&r.addEventListener("click",(function(){var t,n=(null===(t=e.interestsInput)||void 0===t?void 0:t.value)||"";e.loadArticles(n)})),this.articlesContainer.appendChild(n)}},r.prototype.handleInterestsSubmit=function(){var t,e=(null===(t=this.interestsInput)||void 0===t?void 0:t.value)||"";this.loadArticles(e)},r.prototype.formatSummary=function(t){var e=this;return t.split("\n\n").filter((function(t){return t.trim().length>0})).map((function(t){return"<p>".concat(e.escapeHtml(t),"</p>")})).join("")},r.prototype.escapeHtml=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},r}();document.addEventListener("DOMContentLoaded",(function(){new r}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNLFFBQ2RBLFFBQVEsS0FBTSxVQUNkQSxRQUFRLEtBQU0sU0FDdkIsRUFDSixFQXZLQSxHQTBLQXpDLFNBQVNNLGlCQUFpQixvQkFBb0IsV0FDMUMsSUFBSW9DLENBQ1IsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3R5cGVzY3JpcHQtd2VicGFnZS8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IHsgcGlwZWxpbmUgfSBmcm9tICdAeGVub3ZhL3RyYW5zZm9ybWVycyc7XG5pbXBvcnQgeyBzeW5jQ2FjaGUsIGdldENhY2hlZEFydGljbGUsIGdldENhY2hlZFN1bW1hcnksIGdldENhY2hlZFNlYXJjaCB9IGZyb20gJy4vdXRpbHMvY2FjaGVTeW5jJztcblxuLy8gRGVmaW5lIHRoZSB0eXBlIGZvciBjYWxjdWxhdGlvbiBsb2cgc3RlcHNcbmludGVyZmFjZSBDYWxjdWxhdGlvblN0ZXAge1xuICAgIHN0ZXA6IHN0cmluZztcbiAgICB2YWx1ZTogYW55O1xufVxuXG4vLyBVcGRhdGUgdGhlIEFQSV9VUkwgY29uc3RhbnQgdG8gdXNlIHJlbGF0aXZlIHBhdGhzIGZvciBWZXJjZWwgY29tcGF0aWJpbGl0eVxuY29uc3QgQVBJX1VSTCA9ICcnOyAgLy8gRW1wdHkgc3RyaW5nIGZvciByZWxhdGl2ZSBwYXRoc1xuXG4vLyBBZGQgYSBjdXN0b20gbG9nZ2VyXG5jb25zdCBsb2dUb0ZpbGUgPSBhc3luYyAobWVzc2FnZTogc3RyaW5nLCBsZXZlbDogJ2luZm8nIHwgJ2Vycm9yJyB8ICdkZWJ1ZycgPSAnaW5mbycpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgICAvLyBMb2cgdG8gY29uc29sZVxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZE1lc3NhZ2UgPSBgWyR7dGltZXN0YW1wfV0gWyR7bGV2ZWwudG9VcHBlckNhc2UoKX1dICR7bWVzc2FnZX1gO1xuICAgICAgICBcbiAgICAgICAgLy8gU3RhbmRhcmQgY29uc29sZSBsb2dnaW5nXG4gICAgICAgIGlmIChsZXZlbCA9PT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihmb3JtYXR0ZWRNZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIGlmIChsZXZlbCA9PT0gJ2RlYnVnJykge1xuICAgICAgICAgICAgY29uc29sZS5kZWJ1Zyhmb3JtYXR0ZWRNZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGZvcm1hdHRlZE1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBTZW5kIGxvZyB0byBiYWNrZW5kIHRvIHdyaXRlIHRvIGZpbGVcbiAgICAgICAgYXdhaXQgZmV0Y2goYCR7QVBJX1VSTH0vbG9nYCwge1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBmb3JtYXR0ZWRNZXNzYWdlLFxuICAgICAgICAgICAgICAgIGxldmVsLFxuICAgICAgICAgICAgICAgIHNvdXJjZTogJ2Zyb250ZW5kJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gSWYgbG9nZ2luZyBmYWlscywgYXQgbGVhc3Qgc2hvdyBpbiBjb25zb2xlXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2cgdG8gZmlsZTogJHtlcnJvcn1gKTtcbiAgICB9XG59O1xuXG5pbnRlcmZhY2UgQXJ0aWNsZSB7XG4gICAgdGl0bGU6IHN0cmluZztcbiAgICBsaW5rOiBzdHJpbmc7XG4gICAgc3ViamVjdDogc3RyaW5nO1xuICAgIHNjb3JlOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBBcnRpY2xlRGV0YWlsIHtcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIGxpbms6IHN0cmluZztcbiAgICBzdW1tYXJ5OiBzdHJpbmc7XG59XG5cbi8vIEFQSSBTZXJ2aWNlXG5jbGFzcyBBcGlTZXJ2aWNlIHtcbiAgICBwcml2YXRlIGJhc2VVcmw6IHN0cmluZyA9ICcnO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vIEluIGRldmVsb3BtZW50LCB1c2UgYSBkaWZmZXJlbnQgYmFzZSBVUkxcbiAgICAgICAgdGhpcy5iYXNlVXJsID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lID09PSAnbG9jYWxob3N0JyBcbiAgICAgICAgICAgID8gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCcgXG4gICAgICAgICAgICA6ICcnO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYEFwaVNlcnZpY2UgaW5pdGlhbGl6ZWQgd2l0aCBiYXNlVXJsOiAke3RoaXMuYmFzZVVybH1gKTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRBcnRpY2xlcyhpbnRlcmVzdHM/OiBzdHJpbmcpOiBQcm9taXNlPEFydGljbGVbXT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSBpbnRlcmVzdHMgPyBgP2ludGVyZXN0cz0ke2VuY29kZVVSSUNvbXBvbmVudChpbnRlcmVzdHMpfWAgOiAnJztcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vYXBpL2FydGljbGVzJHtxdWVyeVBhcmFtc31gO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYEZldGNoaW5nIGFydGljbGVzIGZyb206ICR7dXJsfWApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciByZXNwb25zZSBmcm9tIHNlcnZlcjogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggYXJ0aWNsZXM6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBBcnRpY2xlcyBmZXRjaGVkIHN1Y2Nlc3NmdWxseS4gQ291bnQ6ICR7ZGF0YS5sZW5ndGh9YCk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGFydGljbGVzOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldEFydGljbGVEZXRhaWxzKGFydGljbGVJZDogc3RyaW5nKTogUHJvbWlzZTxBcnRpY2xlRGV0YWlsIHwgbnVsbD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS9hcGkvYXJ0aWNsZS8ke2FydGljbGVJZH1gO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYEZldGNoaW5nIGFydGljbGUgZGV0YWlscyBmcm9tOiAke3VybH1gKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgcmVzcG9uc2UgZnJvbSBzZXJ2ZXI6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIGFydGljbGUgZGV0YWlsczogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0FydGljbGUgZGV0YWlscyBmZXRjaGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBhcnRpY2xlIGRldGFpbHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBhbmFseXplSW50ZXJlc3RzKGludGVyZXN0czogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9hcGkvYW5hbHl6ZS1pbnRlcmVzdHNgLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGludGVyZXN0cyB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBhbmFseXplIGludGVyZXN0cycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYW5hbHl6aW5nIGludGVyZXN0czonLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy8gVUkgQ29udHJvbGxlclxuY2xhc3MgQXBwQ29udHJvbGxlciB7XG4gICAgcHJpdmF0ZSBhcGlTZXJ2aWNlOiBBcGlTZXJ2aWNlO1xuICAgIHByaXZhdGUgYXJ0aWNsZXNDb250YWluZXI6IEhUTUxFbGVtZW50IHwgbnVsbDtcbiAgICBwcml2YXRlIGludGVyZXN0c0lucHV0OiBIVE1MSW5wdXRFbGVtZW50IHwgbnVsbDtcbiAgICBwcml2YXRlIHN1Ym1pdEJ1dHRvbjogSFRNTEVsZW1lbnQgfCBudWxsO1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmFwaVNlcnZpY2UgPSBuZXcgQXBpU2VydmljZSgpO1xuICAgICAgICB0aGlzLmFydGljbGVzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FydGljbGVzLWNvbnRhaW5lcicpO1xuICAgICAgICB0aGlzLmludGVyZXN0c0lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludGVyZXN0cy1pbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIHRoaXMuc3VibWl0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1Ym1pdC1pbnRlcmVzdHMnKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuaW5pdEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMubG9hZEFydGljbGVzKCk7XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgaW5pdEV2ZW50TGlzdGVuZXJzKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zdWJtaXRCdXR0b24pIHtcbiAgICAgICAgICAgIHRoaXMuc3VibWl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5oYW5kbGVJbnRlcmVzdHNTdWJtaXQoKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBhc3luYyBsb2FkQXJ0aWNsZXMoaW50ZXJlc3RzPzogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICghdGhpcy5hcnRpY2xlc0NvbnRhaW5lcikgcmV0dXJuO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5hcnRpY2xlc0NvbnRhaW5lci5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cImxvYWRpbmdcIj5Mb2FkaW5nIGFydGljbGVzLi4uPC9kaXY+JztcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBhcnRpY2xlcyA9IGF3YWl0IHRoaXMuYXBpU2VydmljZS5nZXRBcnRpY2xlcyhpbnRlcmVzdHMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoYXJ0aWNsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcnRpY2xlc0NvbnRhaW5lci5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cImVycm9yXCI+Tm8gYXJ0aWNsZXMgZm91bmQ8L2Rpdj4nO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5yZW5kZXJBcnRpY2xlcyhhcnRpY2xlcyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIGFydGljbGVzOicsIGVycm9yKTtcbiAgICAgICAgICAgIHRoaXMuYXJ0aWNsZXNDb250YWluZXIuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9XCJlcnJvclwiPkVycm9yIGxvYWRpbmcgYXJ0aWNsZXMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuPC9kaXY+JztcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHJlbmRlckFydGljbGVzKGFydGljbGVzOiBBcnRpY2xlW10pOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLmFydGljbGVzQ29udGFpbmVyKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICB0aGlzLmFydGljbGVzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgICAgICBcbiAgICAgICAgYXJ0aWNsZXMuZm9yRWFjaChhcnRpY2xlID0+IHtcbiAgICAgICAgICAgIC8vIEV4dHJhY3QgYXJ0aWNsZSBJRCBmcm9tIGxpbmtcbiAgICAgICAgICAgIGNvbnN0IGFydGljbGVJZCA9IGFydGljbGUubGluay5zcGxpdCgnaWQ9JylbMV0gfHwgJyc7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFydGljbGVDYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBhcnRpY2xlQ2FyZC5jbGFzc05hbWUgPSAnYXJ0aWNsZS1jYXJkJztcbiAgICAgICAgICAgIGFydGljbGVDYXJkLmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYXJ0aWNsZS1oZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzPVwiYXJ0aWNsZS10aXRsZVwiPiR7dGhpcy5lc2NhcGVIdG1sKGFydGljbGUudGl0bGUpfTwvaDM+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiYXJ0aWNsZS1zY29yZVwiPlNjb3JlOiAke2FydGljbGUuc2NvcmV9PC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJhcnRpY2xlLWJvZHlcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImFydGljbGUtc3ViamVjdFwiPiR7dGhpcy5lc2NhcGVIdG1sKGFydGljbGUuc3ViamVjdCl9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCIvYXJ0aWNsZS8ke2FydGljbGVJZH1cIiBjbGFzcz1cImFydGljbGUtbGlua1wiIGRhdGEtYXJ0aWNsZS1pZD1cIiR7YXJ0aWNsZUlkfVwiPlJlYWQgbW9yZTwvYT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEFkZCBjbGljayBldmVudCB0byB2aWV3IGFydGljbGUgZGV0YWlsc1xuICAgICAgICAgICAgY29uc3QgYXJ0aWNsZUxpbmsgPSBhcnRpY2xlQ2FyZC5xdWVyeVNlbGVjdG9yKCcuYXJ0aWNsZS1saW5rJykgYXMgSFRNTEFuY2hvckVsZW1lbnQ7XG4gICAgICAgICAgICBpZiAoYXJ0aWNsZUxpbmspIHtcbiAgICAgICAgICAgICAgICBhcnRpY2xlTGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3QXJ0aWNsZURldGFpbHMoYXJ0aWNsZUlkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5hcnRpY2xlc0NvbnRhaW5lcj8uYXBwZW5kQ2hpbGQoYXJ0aWNsZUNhcmQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBhc3luYyB2aWV3QXJ0aWNsZURldGFpbHMoYXJ0aWNsZUlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCF0aGlzLmFydGljbGVzQ29udGFpbmVyKSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICB0aGlzLmFydGljbGVzQ29udGFpbmVyLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPVwibG9hZGluZ1wiPkxvYWRpbmcgYXJ0aWNsZSBkZXRhaWxzLi4uPC9kaXY+JztcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBhcnRpY2xlRGV0YWlsID0gYXdhaXQgdGhpcy5hcGlTZXJ2aWNlLmdldEFydGljbGVEZXRhaWxzKGFydGljbGVJZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghYXJ0aWNsZURldGFpbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJ0aWNsZXNDb250YWluZXIuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9XCJlcnJvclwiPkFydGljbGUgbm90IGZvdW5kPC9kaXY+JztcbiAgICAgICAgICAgICAgICAvLyBBZGQgYSBiYWNrIGJ1dHRvbiBldmVuIHdoZW4gYXJ0aWNsZSBpcyBub3QgZm91bmRcbiAgICAgICAgICAgICAgICBjb25zdCBiYWNrQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgICAgICAgICAgYmFja0J1dHRvbi50ZXh0Q29udGVudCA9ICdCYWNrIHRvIEFydGljbGVzJztcbiAgICAgICAgICAgICAgICBiYWNrQnV0dG9uLmNsYXNzTmFtZSA9ICdiYWNrLWJ1dHRvbic7XG4gICAgICAgICAgICAgICAgYmFja0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW50ZXJlc3RzID0gdGhpcy5pbnRlcmVzdHNJbnB1dD8udmFsdWUgfHwgJyc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZEFydGljbGVzKGludGVyZXN0cyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcnRpY2xlc0NvbnRhaW5lci5hcHBlbmRDaGlsZChiYWNrQnV0dG9uKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQXJ0aWNsZURldGFpbChhcnRpY2xlRGV0YWlsKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgYXJ0aWNsZSBkZXRhaWxzOicsIGVycm9yKTtcbiAgICAgICAgICAgIHRoaXMuYXJ0aWNsZXNDb250YWluZXIuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9XCJlcnJvclwiPkVycm9yIGxvYWRpbmcgYXJ0aWNsZSBkZXRhaWxzLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLjwvZGl2Pic7XG4gICAgICAgICAgICAvLyBBZGQgYSBiYWNrIGJ1dHRvbiBldmVuIHdoZW4gdGhlcmUncyBhbiBlcnJvclxuICAgICAgICAgICAgY29uc3QgYmFja0J1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICAgICAgYmFja0J1dHRvbi50ZXh0Q29udGVudCA9ICdCYWNrIHRvIEFydGljbGVzJztcbiAgICAgICAgICAgIGJhY2tCdXR0b24uY2xhc3NOYW1lID0gJ2JhY2stYnV0dG9uJztcbiAgICAgICAgICAgIGJhY2tCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW50ZXJlc3RzID0gdGhpcy5pbnRlcmVzdHNJbnB1dD8udmFsdWUgfHwgJyc7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkQXJ0aWNsZXMoaW50ZXJlc3RzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5hcnRpY2xlc0NvbnRhaW5lci5hcHBlbmRDaGlsZChiYWNrQnV0dG9uKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHJlbmRlckFydGljbGVEZXRhaWwoYXJ0aWNsZTogQXJ0aWNsZURldGFpbCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuYXJ0aWNsZXNDb250YWluZXIpIHJldHVybjtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuYXJ0aWNsZXNDb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBhcnRpY2xlRGV0YWlsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGFydGljbGVEZXRhaWwuY2xhc3NOYW1lID0gJ2FydGljbGUtZGV0YWlsJztcbiAgICAgICAgYXJ0aWNsZURldGFpbC5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8aDI+JHt0aGlzLmVzY2FwZUh0bWwoYXJ0aWNsZS50aXRsZSl9PC9oMj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJhcnRpY2xlLXN1bW1hcnlcIj5cbiAgICAgICAgICAgICAgICAke3RoaXMuZm9ybWF0U3VtbWFyeShhcnRpY2xlLnN1bW1hcnkpfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYXJ0aWNsZS1hY3Rpb25zXCI+XG4gICAgICAgICAgICAgICAgPGEgaHJlZj1cIiR7YXJ0aWNsZS5saW5rfVwiIHRhcmdldD1cIl9ibGFua1wiIGNsYXNzPVwiYXJ0aWNsZS1saW5rXCI+VmlldyBPcmlnaW5hbDwvYT5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPVwiYmFjay10by1hcnRpY2xlc1wiIGNsYXNzPVwiYmFjay1idXR0b25cIj5CYWNrIHRvIEFydGljbGVzPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBiYWNrIGJ1dHRvbiBjbGljayBldmVudFxuICAgICAgICBjb25zdCBiYWNrQnV0dG9uID0gYXJ0aWNsZURldGFpbC5xdWVyeVNlbGVjdG9yKCcjYmFjay10by1hcnRpY2xlcycpO1xuICAgICAgICBpZiAoYmFja0J1dHRvbikge1xuICAgICAgICAgICAgYmFja0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbnRlcmVzdHMgPSB0aGlzLmludGVyZXN0c0lucHV0Py52YWx1ZSB8fCAnJztcbiAgICAgICAgICAgICAgICB0aGlzLmxvYWRBcnRpY2xlcyhpbnRlcmVzdHMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMuYXJ0aWNsZXNDb250YWluZXIuYXBwZW5kQ2hpbGQoYXJ0aWNsZURldGFpbCk7XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgaGFuZGxlSW50ZXJlc3RzU3VibWl0KCk6IHZvaWQge1xuICAgICAgICBjb25zdCBpbnRlcmVzdHMgPSB0aGlzLmludGVyZXN0c0lucHV0Py52YWx1ZSB8fCAnJztcbiAgICAgICAgdGhpcy5sb2FkQXJ0aWNsZXMoaW50ZXJlc3RzKTtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBmb3JtYXRTdW1tYXJ5KHN1bW1hcnk6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIC8vIFJlcGxhY2UgbmV3bGluZXMgd2l0aCBwYXJhZ3JhcGggYnJlYWtzXG4gICAgICAgIHJldHVybiBzdW1tYXJ5XG4gICAgICAgICAgICAuc3BsaXQoJ1xcblxcbicpXG4gICAgICAgICAgICAuZmlsdGVyKHBhcmFncmFwaCA9PiBwYXJhZ3JhcGgudHJpbSgpLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAubWFwKHBhcmFncmFwaCA9PiBgPHA+JHt0aGlzLmVzY2FwZUh0bWwocGFyYWdyYXBoKX08L3A+YClcbiAgICAgICAgICAgIC5qb2luKCcnKTtcbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBlc2NhcGVIdG1sKHVuc2FmZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHVuc2FmZVxuICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgXCImYW1wO1wiKVxuICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgXCImbHQ7XCIpXG4gICAgICAgICAgICAucmVwbGFjZSgvPi9nLCBcIiZndDtcIilcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cIi9nLCBcIiZxdW90O1wiKVxuICAgICAgICAgICAgLnJlcGxhY2UoLycvZywgXCImIzAzOTtcIik7XG4gICAgfVxufVxuXG4vLyBJbml0aWFsaXplIHRoZSBhcHAgd2hlbiBET00gaXMgbG9hZGVkXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xuICAgIG5ldyBBcHBDb250cm9sbGVyKCk7XG59KTsgIl0sIm5hbWVzIjpbImJhc2VVcmwiLCJ0aGlzIiwid2luZG93IiwibG9jYXRpb24iLCJob3N0bmFtZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRBcnRpY2xlcyIsImludGVyZXN0cyIsInF1ZXJ5UGFyYW1zIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwidXJsIiwiZmV0Y2giLCJyZXNwb25zZSIsIm9rIiwiZXJyb3IiLCJzdGF0dXMiLCJFcnJvciIsInN0YXR1c1RleHQiLCJqc29uIiwiZGF0YSIsImxlbmd0aCIsImdldEFydGljbGVEZXRhaWxzIiwiYXJ0aWNsZUlkIiwiYW5hbHl6ZUludGVyZXN0cyIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFwaVNlcnZpY2UiLCJBcGlTZXJ2aWNlIiwiYXJ0aWNsZXNDb250YWluZXIiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW50ZXJlc3RzSW5wdXQiLCJzdWJtaXRCdXR0b24iLCJpbml0RXZlbnRMaXN0ZW5lcnMiLCJsb2FkQXJ0aWNsZXMiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlSW50ZXJlc3RzU3VibWl0IiwiaW5uZXJIVE1MIiwiYXJ0aWNsZXMiLCJyZW5kZXJBcnRpY2xlcyIsImZvckVhY2giLCJhcnRpY2xlIiwibGluayIsInNwbGl0IiwiYXJ0aWNsZUNhcmQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwiZXNjYXBlSHRtbCIsInRpdGxlIiwic2NvcmUiLCJzdWJqZWN0IiwiYXJ0aWNsZUxpbmsiLCJxdWVyeVNlbGVjdG9yIiwiZSIsInByZXZlbnREZWZhdWx0Iiwidmlld0FydGljbGVEZXRhaWxzIiwiYXBwZW5kQ2hpbGQiLCJhcnRpY2xlRGV0YWlsIiwicmVuZGVyQXJ0aWNsZURldGFpbCIsImJhY2tCdXR0b24iLCJ0ZXh0Q29udGVudCIsInZhbHVlIiwiZm9ybWF0U3VtbWFyeSIsInN1bW1hcnkiLCJmaWx0ZXIiLCJwYXJhZ3JhcGgiLCJ0cmltIiwibWFwIiwiam9pbiIsInVuc2FmZSIsInJlcGxhY2UiLCJBcHBDb250cm9sbGVyIl0sInNvdXJjZVJvb3QiOiIifQ==