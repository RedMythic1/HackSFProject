"use strict";Object.defineProperty(exports, "__esModule", {value: true});











var _chunkA365AHMYcjs = require('./chunk-A365AHMY.cjs');

// src/index.ts
var _undici = require('undici');

// src/copy.ts

async function copy(fromUrl, toPathname, options) {
  if (!options) {
    throw new (0, _chunkA365AHMYcjs.BlobError)("missing options, see usage");
  }
  if (options.access !== "public") {
    throw new (0, _chunkA365AHMYcjs.BlobError)('access must be "public"');
  }
  const headers = {
    ..._chunkA365AHMYcjs.getApiVersionHeader.call(void 0, ),
    authorization: `Bearer ${_chunkA365AHMYcjs.getTokenFromOptionsOrEnv.call(void 0, options)}`
  };
  if (options.addRandomSuffix !== void 0) {
    headers["x-add-random-suffix"] = options.addRandomSuffix ? "1" : "0";
  }
  if (options.contentType) {
    headers["x-content-type"] = options.contentType;
  }
  if (options.cacheControlMaxAge !== void 0) {
    headers["x-cache-control-max-age"] = options.cacheControlMaxAge.toString();
  }
  const blobApiResponse = await _undici.fetch.call(void 0, 
    _chunkA365AHMYcjs.getApiUrl.call(void 0, `/${toPathname}?fromUrl=${fromUrl}`),
    { method: "PUT", headers }
  );
  await _chunkA365AHMYcjs.validateBlobApiResponse.call(void 0, blobApiResponse);
  return await blobApiResponse.json();
}

// src/index.ts
var put = _chunkA365AHMYcjs.createPutMethod.call(void 0, {
  allowedOptions: ["cacheControlMaxAge", "addRandomSuffix", "contentType"]
});
async function del(url, options) {
  const blobApiResponse = await _undici.fetch.call(void 0, _chunkA365AHMYcjs.getApiUrl.call(void 0, "/delete"), {
    method: "POST",
    headers: {
      ..._chunkA365AHMYcjs.getApiVersionHeader.call(void 0, ),
      authorization: `Bearer ${_chunkA365AHMYcjs.getTokenFromOptionsOrEnv.call(void 0, options)}`,
      "content-type": "application/json"
    },
    body: JSON.stringify({ urls: Array.isArray(url) ? url : [url] })
  });
  await _chunkA365AHMYcjs.validateBlobApiResponse.call(void 0, blobApiResponse);
  await blobApiResponse.json();
}
async function head(url, options) {
  const headApiUrl = new URL(_chunkA365AHMYcjs.getApiUrl.call(void 0, ));
  headApiUrl.searchParams.set("url", url);
  const blobApiResponse = await _undici.fetch.call(void 0, headApiUrl, {
    method: "GET",
    // HEAD can't have body as a response, so we use GET
    headers: {
      ..._chunkA365AHMYcjs.getApiVersionHeader.call(void 0, ),
      authorization: `Bearer ${_chunkA365AHMYcjs.getTokenFromOptionsOrEnv.call(void 0, options)}`
    }
  });
  await _chunkA365AHMYcjs.validateBlobApiResponse.call(void 0, blobApiResponse);
  const headResult = await blobApiResponse.json();
  return mapBlobResult(headResult);
}
async function list(options) {
  const listApiUrl = new URL(_chunkA365AHMYcjs.getApiUrl.call(void 0, ));
  if (options == null ? void 0 : options.limit) {
    listApiUrl.searchParams.set("limit", options.limit.toString());
  }
  if (options == null ? void 0 : options.prefix) {
    listApiUrl.searchParams.set("prefix", options.prefix);
  }
  if (options == null ? void 0 : options.cursor) {
    listApiUrl.searchParams.set("cursor", options.cursor);
  }
  const blobApiResponse = await _undici.fetch.call(void 0, listApiUrl, {
    method: "GET",
    headers: {
      ..._chunkA365AHMYcjs.getApiVersionHeader.call(void 0, ),
      authorization: `Bearer ${_chunkA365AHMYcjs.getTokenFromOptionsOrEnv.call(void 0, options)}`
    }
  });
  await _chunkA365AHMYcjs.validateBlobApiResponse.call(void 0, blobApiResponse);
  const results = await blobApiResponse.json();
  return {
    ...results,
    blobs: results.blobs.map(mapBlobResult)
  };
}
function mapBlobResult(blobResult) {
  return {
    ...blobResult,
    uploadedAt: new Date(blobResult.uploadedAt)
  };
}












exports.BlobAccessError = _chunkA365AHMYcjs.BlobAccessError; exports.BlobError = _chunkA365AHMYcjs.BlobError; exports.BlobNotFoundError = _chunkA365AHMYcjs.BlobNotFoundError; exports.BlobStoreNotFoundError = _chunkA365AHMYcjs.BlobStoreNotFoundError; exports.BlobStoreSuspendedError = _chunkA365AHMYcjs.BlobStoreSuspendedError; exports.BlobUnknownError = _chunkA365AHMYcjs.BlobUnknownError; exports.copy = copy; exports.del = del; exports.head = head; exports.list = list; exports.put = put;
//# sourceMappingURL=index.cjs.map